(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=i(s);fetch(s.href,c)}})();const t={ws:new WebSocket("ws://localhost:8081"),canvas:null,ctx:null,tempCanvas:document.createElement("canvas"),tempCtx:null,isDrawing:!1,lastPoint:null,currentColor:"#000000",currentLineWidth:2,currentTool:"pencil",isConnected:!1};function y(e,n){if(!t.ctx||!t.canvas)return;const i={tool:t.currentTool,color:t.currentColor,line_width:t.currentLineWidth,start_x:e.x,start_y:e.y,end_x:n.x,end_y:n.y};t.isConnected&&t.ws.send(JSON.stringify(i)),t.ctx.strokeStyle=t.currentColor,t.ctx.lineWidth=t.currentLineWidth,t.ctx.lineCap="round",t.ctx.beginPath(),t.ctx.moveTo(e.x,e.y),t.ctx.lineTo(n.x,n.y),t.ctx.stroke()}function g(e){if(!t.ctx)return;const n={x:e.start_x,y:e.start_y},i={x:e.end_x,y:e.end_y};t.ctx.strokeStyle=e.color,t.ctx.lineWidth=e.line_width,t.ctx.lineCap="round",t.ctx.beginPath(),t.ctx.moveTo(n.x,n.y),t.ctx.lineTo(i.x,i.y),t.ctx.stroke()}const o={width:1080,height:1080},C=()=>{t.canvas=document.getElementById("canvas"),t.ctx=t.canvas.getContext("2d"),t.tempCtx=t.tempCanvas.getContext("2d");const e=window.innerWidth-40,n=window.innerHeight-40,i=Math.min(e/o.width,n/o.height),r=Math.floor(o.width*i),s=Math.floor(o.height*i);t.canvas.style.width=`${r}px`,t.canvas.style.height=`${s}px`,t.tempCanvas.style.width=`${r}px`,t.tempCanvas.style.height=`${s}px`,t.canvas.width=o.width,t.canvas.height=o.height,t.tempCanvas.width=o.width,t.tempCanvas.height=o.height,t.ctx.fillStyle="white",t.ctx.fillRect(0,0,o.width,o.height)},L=()=>{if(!t.canvas||!t.ctx||!t.tempCtx)return;const e=t.ctx.getImageData(0,0,o.width,o.height),n=window.innerWidth-40,i=window.innerHeight-40,r=Math.min(n/o.width,i/o.height),s=Math.floor(o.width*r),c=Math.floor(o.height*r);t.canvas.style.width=`${s}px`,t.canvas.style.height=`${c}px`,t.tempCanvas.style.width=`${s}px`,t.tempCanvas.style.height=`${c}px`,t.ctx.putImageData(e,0,0),t.tempCtx.clearRect(0,0,o.width,o.height),t.tempCtx.drawImage(t.canvas,0,0)},E=()=>{t.canvas&&(t.canvas.addEventListener("mousedown",p),t.canvas.addEventListener("mousemove",w),t.canvas.addEventListener("mouseup",h),t.canvas.addEventListener("mouseout",h),t.canvas.addEventListener("touchstart",S),t.canvas.addEventListener("touchmove",W),t.canvas.addEventListener("touchend",h),t.canvas.addEventListener("touchcancel",h))};function p(e){var s,c;if(!t.canvas)return;t.isDrawing=!0;const n=t.canvas.getBoundingClientRect(),i=t.canvas.width/n.width,r=t.canvas.height/n.height;t.lastPoint={x:(e.clientX-n.left)*i,y:(e.clientY-n.top)*r},(s=t.tempCtx)==null||s.clearRect(0,0,t.canvas.width,t.canvas.height),(c=t.tempCtx)==null||c.drawImage(t.canvas,0,0)}const h=()=>{!t.canvas||!t.tempCtx||(t.isDrawing&&(t.tempCtx.clearRect(0,0,t.canvas.width,t.canvas.height),t.tempCtx.drawImage(t.canvas,0,0)),t.isDrawing=!1,t.lastPoint=null)},w=e=>{if(!t.isDrawing||!t.lastPoint||!t.canvas||!t.ctx)return;const n=t.canvas.getBoundingClientRect(),i=t.canvas.width/n.width,r=t.canvas.height/n.height,s={x:(e.clientX-n.left)*i,y:(e.clientY-n.top)*r};y(t.lastPoint,s),t.lastPoint=s},S=e=>{if(e.preventDefault(),!t.canvas)return;const n=e.touches[0],i=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});p(i)},W=e=>{if(e.preventDefault(),!t.canvas)return;const n=e.touches[0],i=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});w(i)},u=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00"],I=1,M=50,Y=.5;function D(){const e=document.getElementById("control"),n=document.querySelector(".control-preview");let i=0,r=0,s=!1,c=0;const l=a=>{i=(a+u.length)%u.length;const d=u[i];t.currentColor=d,n.style.setProperty("--current-color",d)},v=(a,d)=>{const m=a-d,x=Math.max(I,Math.min(M,c+m*Y));t.currentLineWidth=Math.round(x),n.style.setProperty("--current-size",String(t.currentLineWidth))};e.addEventListener("mousedown",a=>{s=!1,r=a.clientY,c=t.currentLineWidth}),e.addEventListener("mousemove",a=>{a.buttons===1&&(s=!0,v(r,a.clientY))}),e.addEventListener("click",()=>{s||l(i+1)}),e.addEventListener("touchstart",a=>{r=a.touches[0].clientY,c=t.currentLineWidth}),e.addEventListener("touchmove",a=>{a.preventDefault(),s=!0,v(r,a.touches[0].clientY)}),e.addEventListener("touchend",()=>{s||l(i+1),s=!1}),l(0),n.style.setProperty("--current-size",String(t.currentLineWidth))}const f=()=>{t.ws.onopen=()=>{t.isConnected=!0,t.ws.send(JSON.stringify({type:"requestState"}))},t.ws.onmessage=e=>{const n=JSON.parse(e.data);if(Array.isArray(n))for(const i of n)g(i);else g(n)},t.ws.onerror=e=>console.error("WebSocket error:",e),t.ws.onclose=()=>{t.isConnected=!1,setTimeout(()=>{t.ws=new WebSocket("ws://localhost:8081"),f()},3e3)}};function _(){C(),f(),E(),D(),window.addEventListener("resize",L)}document.addEventListener("DOMContentLoaded",_);
