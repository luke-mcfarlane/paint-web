(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const t={ws:new WebSocket("ws://localhost:8081"),canvas:null,ctx:null,tempCanvas:document.createElement("canvas"),tempCtx:null,isDrawing:!1,lastPoint:null,currentColor:"#000000",currentLineWidth:2,currentTool:"pencil"};function f(n,i){if(!t.ctx||!t.canvas)return;const s={tool:t.currentTool,color:t.currentColor,line_width:t.currentLineWidth,start_x:n.x,start_y:n.y,end_x:i.x,end_y:i.y};t.ws.send(JSON.stringify(s)),t.ctx.strokeStyle=t.currentColor,t.ctx.lineWidth=t.currentLineWidth,t.ctx.lineCap="round",t.ctx.beginPath(),t.ctx.moveTo(n.x,n.y),t.ctx.lineTo(i.x,i.y),t.ctx.stroke()}function g(n){if(!t.ctx)return;const i={x:n.start_x,y:n.start_y},s={x:n.end_x,y:n.end_y};t.ctx.strokeStyle=n.color,t.ctx.lineWidth=n.line_width,t.ctx.lineCap="round",t.ctx.beginPath(),t.ctx.moveTo(i.x,i.y),t.ctx.lineTo(s.x,s.y),t.ctx.stroke()}const r={width:1080,height:1080},x=()=>{t.canvas=document.getElementById("canvas"),t.ctx=t.canvas.getContext("2d"),t.tempCtx=t.tempCanvas.getContext("2d");const n=window.innerWidth-40,i=window.innerHeight-40,s=Math.min(n/r.width,i/r.height),c=Math.floor(r.width*s),e=Math.floor(r.height*s);t.canvas.style.width=`${c}px`,t.canvas.style.height=`${e}px`,t.tempCanvas.style.width=`${c}px`,t.tempCanvas.style.height=`${e}px`,t.canvas.width=r.width,t.canvas.height=r.height,t.tempCanvas.width=r.width,t.tempCanvas.height=r.height,t.ctx.fillStyle="white",t.ctx.fillRect(0,0,r.width,r.height)},y=()=>{if(!t.canvas||!t.ctx||!t.tempCtx)return;const n=t.ctx.getImageData(0,0,r.width,r.height),i=window.innerWidth-40,s=window.innerHeight-40,c=Math.min(i/r.width,s/r.height),e=Math.floor(r.width*c),o=Math.floor(r.height*c);t.canvas.style.width=`${e}px`,t.canvas.style.height=`${o}px`,t.tempCanvas.style.width=`${e}px`,t.tempCanvas.style.height=`${o}px`,t.ctx.putImageData(n,0,0),t.tempCtx.clearRect(0,0,r.width,r.height),t.tempCtx.drawImage(t.canvas,0,0)},C=()=>{t.canvas&&(t.canvas.addEventListener("mousedown",L),t.canvas.addEventListener("mousemove",S),t.canvas.addEventListener("mouseup",p),t.canvas.addEventListener("mouseout",p))};function L(n){var e,o;if(!t.canvas)return;t.isDrawing=!0;const i=t.canvas.getBoundingClientRect(),s=t.canvas.width/i.width,c=t.canvas.height/i.height;t.lastPoint={x:(n.clientX-i.left)*s,y:(n.clientY-i.top)*c},(e=t.tempCtx)==null||e.clearRect(0,0,t.canvas.width,t.canvas.height),(o=t.tempCtx)==null||o.drawImage(t.canvas,0,0)}const p=()=>{!t.canvas||!t.tempCtx||(t.isDrawing&&(t.tempCtx.clearRect(0,0,t.canvas.width,t.canvas.height),t.tempCtx.drawImage(t.canvas,0,0)),t.isDrawing=!1,t.lastPoint=null)},S=n=>{if(!t.isDrawing||!t.lastPoint||!t.canvas||!t.ctx)return;const i=t.canvas.getBoundingClientRect(),s=t.canvas.width/i.width,c=t.canvas.height/i.height,e={x:(n.clientX-i.left)*s,y:(n.clientY-i.top)*c};f(t.lastPoint,e),t.lastPoint=e},h=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00"],E=1,W=50,I=.5;function M(){const n=document.getElementById("control"),i=document.querySelector(".control-preview");let s=0,c=0,e=!1,o=0;const l=a=>{s=(a+h.length)%h.length;const d=h[s];t.currentColor=d,i.style.setProperty("--current-color",d)},u=(a,d)=>{const w=a-d,m=Math.max(E,Math.min(W,o+w*I));t.currentLineWidth=Math.round(m),i.style.setProperty("--current-size",String(t.currentLineWidth))};n.addEventListener("mousedown",a=>{e=!1,c=a.clientY,o=t.currentLineWidth}),n.addEventListener("mousemove",a=>{a.buttons===1&&(e=!0,u(c,a.clientY))}),n.addEventListener("click",()=>{e||l(s+1)}),n.addEventListener("touchstart",a=>{c=a.touches[0].clientY,o=t.currentLineWidth}),n.addEventListener("touchmove",a=>{a.preventDefault(),e=!0,u(c,a.touches[0].clientY)}),n.addEventListener("touchend",()=>{e||l(s+1),e=!1}),l(0),i.style.setProperty("--current-size",String(t.currentLineWidth))}const v=()=>{t.ws.onopen=()=>t.ws.send(JSON.stringify({type:"requestState"})),t.ws.onmessage=n=>{const i=JSON.parse(n.data);if(Array.isArray(i))for(const s of i)g(s);else g(i)},t.ws.onerror=n=>console.error("WebSocket error:",n),t.ws.onclose=()=>setTimeout(()=>{t.ws=new WebSocket("ws://localhost:8081"),v()},3e3)};function _(){x(),v(),C(),M(),window.addEventListener("resize",y)}document.addEventListener("DOMContentLoaded",_);
